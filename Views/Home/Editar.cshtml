@model ControleEstoqueLoja.Models.Produto
@using ControleEstoqueLoja.Models

<div style="max-width: 500px; margin: 40px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; font-family: sans-serif;">
    
    <h2 style="text-align: center; margin-bottom: 25px;">Editar Produto</h2>

    <form method="post" action="/Home/Editar">
        <input type="hidden" name="id" value="@Model.Id" />

        <label style="font-weight: bold;">Nome do produto:</label><br />
        <input type="text" name="nome" value="@Model.Nome" style="width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;" required />

        <label style="font-weight: bold;">Tipo do produto:</label><br />
        <select name="tipo" style="width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;" required>
            @if (Model.Tipo == TipoProduto.Granel) { <option value="Granel" selected>Granel</option> } 
            else { <option value="Granel">Granel</option> }

            @if (Model.Tipo == TipoProduto.Prateleira) { <option value="Prateleira" selected>Prateleira</option> } 
            else { <option value="Prateleira">Prateleira</option> }

            @if (Model.Tipo == TipoProduto.Geladeira) { <option value="Geladeira" selected>Geladeira</option> } 
            else { <option value="Geladeira">Geladeira</option> }

            @if (Model.Tipo == TipoProduto.Freezer) { <option value="Freezer" selected>Freezer</option> } 
            else { <option value="Freezer">Freezer</option> }
        </select>

        <label style="font-weight: bold;">Preço Unitário:</label><br />
        <div style="display: flex; margin-bottom: 15px; margin-top: 5px;">
            <span style="background: #eee; padding: 8px; border: 1px solid #ccc; border-right: none; border-radius: 4px 0 0 4px;">R$</span>
            <input type="text" id="precoVisual" value="@Model.Preco.ToString("N2")" oninput="formatarMoeda(this)" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 0 4px 4px 0;" required />
        </div>
        <input type="hidden" name="preco" id="precoReal" value="@((Model.Preco * 100).ToString("0"))">

        @* <label id="labelQuantidade" style="font-weight: bold;">Quantidade:</label><br />
        <input type="text" id="quantidadeVisual" oninput="atualizarQuantidade()" style="width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 25px; border: 1px solid #ccc; border-radius: 4px;" required />
        <input type="hidden" name="quantidade" id="quantidadeReal" value="@Model.Quantidade.ToString(System.Globalization.CultureInfo.InvariantCulture)" />
 *@
        <button type="submit" style="background-color: #28a745; color: white; border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px;">
            SALVAR ALTERAÇÕES
        </button>
    </form>

    <div class="text-center mt-3">
        <a href="/Home/Index" class="btn btn-outline-secondary btn-sm">Voltar</a>
    </div>

</div>

<script>
    // Executa assim que a página abre para preencher os campos visuais
    window.onload = function() {
        const qtdReal = document.getElementById('quantidadeReal').value;
        const inputQtd = document.getElementById('quantidadeVisual');

        // Formata a quantidade inicial
        if ("@Model.Tipo" === "Granel") {
            inputQtd.value = parseFloat(qtdReal).toFixed(1).replace('.', ',') + " kg";
        } else {
            inputQtd.value = parseInt(qtdReal);
        }

        // O preço já vem preenchido pelo value="@Model.Preco.ToString("N2")"
    };

    function formatarMoeda(input) {
        let valor = input.value.replace(/\D/g, "");
        if (valor === "") {
            input.value = "";
            document.getElementById("precoReal").value = "";
            return;
        }
        input.value = (parseInt(valor) / 100).toFixed(2).replace(".", ",");
        document.getElementById("precoReal").value = valor;
    }

    function atualizarQuantidade() {
        const tipo = document.getElementsByName('tipo')[0].value;
        const input = document.getElementById('quantidadeVisual');
        const hidden = document.getElementById('quantidadeReal');

        let valor = input.value.replace(/\D/g, '');

        if (tipo === 'Granel') {
            if (valor === '') return;
            let numero = (parseInt(valor) / 10).toFixed(1);
            input.value = numero.replace('.', ',') + ' kg';
            hidden.value = numero;
        } else {
            input.value = valor;
            hidden.value = valor;
        }
    }
</script>


